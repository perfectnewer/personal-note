<svg class="leading-none mm-3ltmb2-1" style="" xmlns="http://www.w3.org/2000/svg"><style>.mm-3ltmb2-1 { line-height: 1; }
.mm-3ltmb2-1 a { color: #0097e6; }
.mm-3ltmb2-1 a:hover { color: #00a8ff; }
.mm-3ltmb2-1-g &gt; path { fill: none; }
.mm-3ltmb2-1-g &gt; g &gt; circle { cursor: pointer; }
.mm-3ltmb2-1-fo &gt; div { display: inline-block; font: 300 16px/20px sans-serif; white-space: nowrap; }
.mm-3ltmb2-1-fo code { font-size: calc(1em - 2px); color: #555; background-color: #f0f0f0; border-radius: 2px; }
.mm-3ltmb2-1-fo :not(pre) &gt; code { padding: .2em .4em; }
.mm-3ltmb2-1-fo del { text-decoration: line-through; }
.mm-3ltmb2-1-fo em { font-style: italic; }
.mm-3ltmb2-1-fo strong { font-weight: bolder; }
.mm-3ltmb2-1-fo pre { margin: 0; padding: .2em .4em; }

</style><g class="mm-3ltmb2-1-g" transform="translate(-465.1661989409347,675.9337442595382) scale(1.1962068755051185)"><path d="M247,10C287,10,287,-61.875,327,-61.875" stroke="rgb(255, 127, 14)" stroke-width="2"></path><path d="M247,10C287,10,287,81.875,327,81.875" stroke="rgb(214, 39, 40)" stroke-width="2"></path><path d="M439,-61.875C479,-61.875,479,-141.875,519,-141.875" stroke="rgb(44, 160, 44)" stroke-width="1.5"></path><path d="M439,-61.875C479,-61.875,479,-49.375,519,-49.375" stroke="rgb(227, 119, 194)" stroke-width="1.5"></path><path d="M439,-61.875C479,-61.875,479,18.125,519,18.125" stroke="rgb(255, 127, 14)" stroke-width="1.5"></path><path d="M452,81.875C492,81.875,492,60.625,532,60.625" stroke="rgb(148, 103, 189)" stroke-width="1.5"></path><path d="M452,81.875C492,81.875,492,103.125,532,103.125" stroke="rgb(127, 127, 127)" stroke-width="1.5"></path><path d="M581,-141.875C621,-141.875,621,-166.875,661,-166.875" stroke="rgb(214, 39, 40)" stroke-width="1.5"></path><path d="M581,-141.875C621,-141.875,621,-141.875,661,-141.875" stroke="rgb(148, 103, 189)" stroke-width="1.5"></path><path d="M581,-141.875C621,-141.875,621,-116.875,661,-116.875" stroke="rgb(140, 86, 75)" stroke-width="1.5"></path><path d="M583,-49.375C623,-49.375,623,-86.875,663,-86.875" stroke="rgb(127, 127, 127)" stroke-width="1.5"></path><path d="M583,-49.375C623,-49.375,623,-61.875,663,-61.875" stroke="rgb(188, 189, 34)" stroke-width="1.5"></path><path d="M583,-49.375C623,-49.375,623,-36.875,663,-36.875" stroke="rgb(23, 190, 207)" stroke-width="1.5"></path><path d="M583,-49.375C623,-49.375,623,-11.875,663,-11.875" stroke="rgb(31, 119, 180)" stroke-width="1.5"></path><path d="M575,18.125C615,18.125,615,18.125,655,18.125" stroke="rgb(44, 160, 44)" stroke-width="1.5"></path><path d="M594,60.625C634,60.625,634,48.125,674,48.125" stroke="rgb(140, 86, 75)" stroke-width="1.5"></path><path d="M594,60.625C634,60.625,634,73.125,674,73.125" stroke="rgb(227, 119, 194)" stroke-width="1.5"></path><path d="M598,103.125C638,103.125,638,103.125,678,103.125" stroke="rgb(188, 189, 34)" stroke-width="1.5"></path><g transform="translate(678, 83.125)"><rect x="-1" y="19.25" width="212" height="1.5" fill="rgb(188, 189, 34)"></rect><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="194" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">worker管理和用户代码执行</div></foreignObject></g><g transform="translate(674, 53.125)"><rect x="-1" y="19.25" width="168" height="1.5" fill="rgb(227, 119, 194)"></rect><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="150" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">outqueue：返回结果</div></foreignObject></g><g transform="translate(674, 28.125)"><rect x="-1" y="19.25" width="157" height="1.5" fill="rgb(140, 86, 75)"></rect><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="139" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">inqueue：获取任务</div></foreignObject></g><g transform="translate(655, -1.875)"><rect x="-1" y="19.25" width="210" height="1.5" fill="rgb(44, 160, 44)"></rect><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="192" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">工作进程和主进程结果管理</div></foreignObject></g><g transform="translate(663, -31.875)"><rect x="-1" y="19.25" width="295" height="1.5" fill="rgb(31, 119, 180)"></rect><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="277" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">terminate管理：进程终止时的清理工作</div></foreignObject></g><g transform="translate(663, -56.875)"><rect x="-1" y="19.25" width="267" height="1.5" fill="rgb(23, 190, 207)"></rect><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="249" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">result管理：将worker调用结果写回</div></foreignObject></g><g transform="translate(663, -81.875)"><rect x="-1" y="19.25" width="561" height="1.5" fill="rgb(188, 189, 34)"></rect><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="543" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">task管理：将用户函数调用分配给worker进程。（严格讲是worker进程来拿）</div></foreignObject></g><g transform="translate(663, -106.875)"><rect x="-1" y="19.25" width="271" height="1.5" fill="rgb(127, 127, 127)"></rect><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="253" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">worker process管理：维护进程数目</div></foreignObject></g><g transform="translate(661, -136.875)"><rect x="-1" y="19.25" width="200" height="1.5" fill="rgb(140, 86, 75)"></rect><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="182" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">outqueue：接收任务结果</div></foreignObject></g><g transform="translate(661, -161.875)"><rect x="-1" y="19.25" width="222" height="1.5" fill="rgb(148, 103, 189)"></rect><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="204" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">inqueue：分发任务给worker</div></foreignObject></g><g transform="translate(661, -186.875)"><rect x="-1" y="19.25" width="267" height="1.5" fill="rgb(214, 39, 40)"></rect><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="249" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">user task queue：调用apply等函数</div></foreignObject></g><g transform="translate(532, 83.125)"><rect x="-1" y="19.25" width="68" height="1.5" fill="rgb(127, 127, 127)"></rect><circle stroke-width="1.5" cx="66" cy="20" r="6" stroke="rgb(127, 127, 127)" fill="rgb(255, 255, 255)"></circle><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="50" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">worker</div></foreignObject></g><g transform="translate(532, 40.625)"><rect x="-1" y="19.25" width="64" height="1.5" fill="rgb(148, 103, 189)"></rect><circle stroke-width="1.5" cx="62" cy="20" r="6" stroke="rgb(148, 103, 189)" fill="rgb(255, 255, 255)"></circle><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="46" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">queue</div></foreignObject></g><g transform="translate(519, -1.875)"><rect x="-1" y="19.25" width="58" height="1.5" fill="rgb(255, 127, 14)"></rect><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="40" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">result</div></foreignObject><circle stroke-width="1.5" cx="56" cy="20" r="6" stroke="rgb(255, 127, 14)" fill="rgb(255, 255, 255)"></circle></g><g transform="translate(519, -69.375)"><rect x="-1" y="19.25" width="66" height="1.5" fill="rgb(227, 119, 194)"></rect><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="48" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">thread</div></foreignObject><circle stroke-width="1.5" cx="64" cy="20" r="6" stroke="rgb(227, 119, 194)" fill="rgb(255, 255, 255)"></circle></g><g transform="translate(519, -161.875)"><rect x="-1" y="19.25" width="64" height="1.5" fill="rgb(44, 160, 44)"></rect><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="46" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">queue</div></foreignObject><circle stroke-width="1.5" cx="62" cy="20" r="6" stroke="rgb(44, 160, 44)" fill="rgb(255, 255, 255)"></circle></g><g transform="translate(327, 61.875)"><rect x="-1" y="19" width="127" height="2" fill="rgb(214, 39, 40)"></rect><circle stroke-width="1.5" cx="125" cy="20" r="6" stroke="rgb(214, 39, 40)" fill="rgb(255, 255, 255)"></circle><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="109" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">worker process</div></foreignObject></g><g transform="translate(327, -81.875)"><rect x="-1" y="19" width="114" height="2" fill="rgb(255, 127, 14)"></rect><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="96" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">main process</div></foreignObject><circle stroke-width="1.5" cx="112" cy="20" r="6" stroke="rgb(255, 127, 14)" fill="rgb(255, 255, 255)"></circle></g><g transform="translate(80,-10)"><rect x="-1" y="18" width="169" height="4" fill="rgb(31, 119, 180)"></rect><circle stroke-width="1.5" cx="167" cy="20" r="6" stroke="rgb(31, 119, 180)" fill="rgb(255, 255, 255)"></circle><foreignObject class="mm-3ltmb2-1-fo" x="8" y="0" height="20" width="151" style="opacity: 1;"><div xmlns="http://www.w3.org/1999/xhtml">multiprocessing pool</div></foreignObject></g></g></svg>